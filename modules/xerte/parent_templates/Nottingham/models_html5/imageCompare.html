<script type="text/javascript">
	var imageCompare = new function() {
		this.aspectratio = 1;
		this.position = 50;
		this.isVertical = false;
		// function called every time the page is viewed after it has initially loaded
		this.pageChanged = function() {
			this.position = 50;
			this.updatePosition();
		}
		
		// function called every time the size of the LO is changed
		this.sizeChanged = function() {
			let width = Math.floor($("#pageContents").width()/1.5);
			$(".image_holder").width(width).height(this.aspectratio * width);
		}

		this.updatePosition = function() {
			let img2Elem = $("#img2");
			let slider = $("#slider");
			if(this.isVertical){
				img2Elem.css("clip-path", "inset("+ this.position + "% 0% 0% 0%)");
				slider.css("top", this.position + "%");
			}else {
				img2Elem.css("clip-path", "inset(0% 0% 0%"+ this.position + "%)");
				slider.css("left", this.position + "%");
			}
		}
		
		this.init = function() {
			let loadedimgs = 0;

			let img1Url = x_currentPageXML.getAttribute("url1");
			let img2Url = x_currentPageXML.getAttribute("url2");
			this.isVertical = x_currentPageXML.getAttribute("vertical") == "true" ? true : false;

			let img1Elem = $("#img1")[0];
			let img2Elem = $("#img2")[0];

			let slider = $("#slider");

			let tempImg1 = new Image();
			let tempImg2 = new Image();

			let onImageLoad = () => { 
				loadedimgs++;
				if(loadedimgs == 2){
					let minHeight =  Math.min(tempImg1.height, tempImg2.height);
					let minWidth = Math.min(tempImg1.width, tempImg2.width);
					this.aspectratio = minHeight/minWidth;
					this.sizeChanged();
				}
			};

			img1Elem.onload = onImageLoad;
			img2Elem.onload = onImageLoad;

			if(this.isVertical)
				$("#slider").addClass("vertical");
			else
				$("#slider").addClass("horizontal");

			let prevEvent;
			slider.on("mousedown", function(event) {
				event.preventDefault();
				$(this).data("dragging", true);
				prevEvent = event;
			});
			
			$(".image_holder").on("mousemove", (event) => {
				if(!slider.data("dragging")) return;
				event.preventDefault();
				let deltaPosition;
				if(this.isVertical)
					deltaPosition = 100 / $(".image_holder").height() * (event.screenY-prevEvent.screenY);
				else
					deltaPosition = 100 / $(".image_holder").width() * (event.screenX-prevEvent.screenX);
				this.position = Math.min(100, Math.max(this.position + deltaPosition, 0));
				this.updatePosition();
				prevEvent = event;
				$(".image_holder").css("cursor", "move");
			});

			slider.on("mouseup", function() {
				$(this).data("dragging", false);
				$(".image_holder").css("cursor", "default");
			});
			
			tempImg1.src = img1Url;
			tempImg2.src = img2Url;
			img1Elem.src = img1Url;
			img2Elem.src = img2Url;
			img1Elem.alt = x_currentPageXML.getAttribute("tip1");
			img2Elem.alt = x_currentPageXML.getAttribute("tip2");

			this.updatePosition();

			// call this function in every model once everything's loaded
			x_pageLoaded();
		}
	}
	
	imageCompare.init();
	
</script>

<div id="pageContents">
	<div class="image_holder">
		<img class="image x_noLightBox" id="img1" alt="" src="" />
		<img class="image x_noLightBox" id="img2" alt="" src="" />
		<div id="slider"></div>
	</div>
</div>
